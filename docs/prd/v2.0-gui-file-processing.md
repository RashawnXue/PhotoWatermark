# PhotoWatermark v2.0 GUI文件处理功能 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 功能模块名称
PhotoWatermark GUI界面 - 文件处理模块

### 1.2 功能描述
为PhotoWatermark应用开发图形用户界面，提供直观的文件导入、处理和导出功能。用户可以通过拖拽或文件选择器导入图片，预览图片列表，并自定义导出设置。

### 1.3 功能目标
- 提供用户友好的图形界面替代命令行操作
- 支持直观的拖拽导入和批量文件处理
- 提供丰富的导出选项和文件管理功能
- 保持与现有命令行功能的兼容性

## 2. 功能需求

### 2.1 文件导入功能

#### 2.1.1 单张图片导入
- **拖拽导入**: 支持将图片文件直接拖拽到应用窗口
- **文件选择器**: 提供"选择文件"按钮，打开系统文件选择对话框
- **预览显示**: 导入后立即在界面上显示图片缩略图
- **文件信息**: 显示文件名、文件大小、图片尺寸等基本信息

#### 2.1.2 批量图片导入
- **多选文件**: 文件选择器支持Ctrl/Cmd+点击多选文件
- **文件夹导入**: 提供"选择文件夹"选项，一次性导入整个目录
- **递归导入**: 可选择是否包含子文件夹中的图片
- **批量拖拽**: 支持同时拖拽多个文件到应用窗口

#### 2.1.3 图片列表显示
- **缩略图视图**: 以网格形式显示图片缩略图（建议尺寸：150x150px）
- **列表视图**: 以列表形式显示文件名、尺寸、大小等详细信息
- **视图切换**: 提供缩略图/列表视图切换按钮
- **选择状态**: 支持单选/多选图片，显示选中状态
- **右键菜单**: 提供删除、查看详情等快捷操作

### 2.2 文件格式支持

#### 2.2.1 输入格式支持
- **必须支持**: JPEG (.jpg, .jpeg), PNG (.png)
- **强烈建议支持**: BMP (.bmp), TIFF (.tiff, .tif)
- **PNG透明通道**: 完整支持PNG格式的Alpha透明通道
- **格式检测**: 自动检测并验证文件格式的有效性
- **错误处理**: 对不支持的格式给出明确提示

#### 2.2.2 输出格式选择
- **格式选项**: 提供JPEG和PNG两种输出格式选择
- **格式建议**: 根据原图格式智能推荐输出格式
- **批量设置**: 支持为所有图片统一设置输出格式
- **格式预览**: 显示不同格式的文件大小预估

### 2.3 图片导出功能

#### 2.3.1 输出目录设置
- **目录选择**: 提供文件夹选择器指定输出目录
- **安全保护**: 默认禁止导出到原文件所在目录，防止覆盖
- **目录验证**: 检查输出目录的写入权限
- **目录创建**: 如果指定目录不存在，提示用户是否创建

#### 2.3.2 文件命名规则
- **保留原名**: 选项1 - 保持原始文件名不变
- **添加前缀**: 选项2 - 在文件名前添加自定义前缀（如：wm_）
- **添加后缀**: 选项3 - 在文件名后添加自定义后缀（如：_watermarked）
- **自定义模板**: 支持组合使用前缀和后缀
- **命名预览**: 实时显示重命名后的文件名示例
- **冲突处理**: 如果文件名冲突，自动添加数字后缀

#### 2.3.3 JPEG质量控制
- **质量滑块**: 提供0-100的质量调节滑块
- **质量预览**: 实时显示不同质量下的文件大小预估
- **质量建议**: 提供"高质量(95)"、"标准(85)"、"压缩(70)"等预设
- **批量应用**: 支持将质量设置应用到所有JPEG输出

#### 2.3.4 图片尺寸调整
- **缩放选项**: 
  - 按宽度缩放（保持宽高比）
  - 按高度缩放（保持宽高比）
  - 按百分比缩放（如50%、200%）
  - 自定义尺寸（可选择是否保持宽高比）
- **尺寸预览**: 显示调整后的图片尺寸
- **批量设置**: 支持为所有图片应用相同的缩放设置
- **质量保持**: 使用高质量的图片缩放算法

## 3. 技术需求

### 3.1 GUI框架选择
推荐使用 **tkinter** 或 **PyQt5/PySide2**：

#### 3.1.1 tkinter方案
- **优势**: Python内置，无需额外依赖，轻量级
- **劣势**: 界面美观度一般，功能相对简单
- **适用场景**: 快速原型开发，简单界面需求

#### 3.1.2 PyQt5/PySide2方案
- **优势**: 功能强大，界面美观，跨平台兼容性好
- **劣势**: 需要额外依赖，学习成本较高
- **适用场景**: 专业级应用，复杂界面需求

### 3.2 核心依赖库
- **GUI框架**: tkinter 或 PyQt5/PySide2
- **图像处理**: Pillow (PIL) - 继续使用现有库
- **文件操作**: os, pathlib - 系统标准库
- **拖拽支持**: tkinterdnd2 (tkinter) 或 内置支持 (PyQt)

### 3.3 架构设计

#### 3.3.1 新增模块结构
```
photo_watermark/
├── gui/
│   ├── __init__.py
│   ├── main_window.py      # 主窗口
│   ├── file_manager.py     # 文件管理器
│   ├── image_list.py       # 图片列表组件
│   ├── export_dialog.py    # 导出设置对话框
│   └── widgets/
│       ├── __init__.py
│       ├── drag_drop.py    # 拖拽组件
│       ├── thumbnail.py    # 缩略图组件
│       └── progress.py     # 进度条组件
├── core/                   # 现有核心模块
└── utils/                  # 现有工具模块
```

#### 3.3.2 设计模式
- **MVC模式**: 分离界面、逻辑和数据
- **观察者模式**: 用于界面状态更新
- **命令模式**: 用于操作的撤销/重做

## 4. 用户界面设计

### 4.1 主窗口布局
```
┌─────────────────────────────────────────────────────────────┐
│ 菜单栏: 文件 编辑 视图 帮助                                    │
├─────────────────────────────────────────────────────────────┤
│ 工具栏: [导入文件] [导入文件夹] [导出] [设置]                   │
├─────────────────────────────────────────────────────────────┤
│ 左侧面板 │                主要区域                          │
│ - 导入设置 │  ┌─────────────────────────────────────────┐   │
│ - 水印设置 │  │                                         │   │
│ - 导出设置 │  │         图片列表/缩略图区域              │   │
│          │  │                                         │   │
│          │  │    [拖拽文件到此处或点击导入按钮]        │   │
│          │  │                                         │   │
│          │  └─────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│ 状态栏: 已导入X张图片 | 准备就绪                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 导出设置对话框
```
┌─────────────────────────────────────────┐
│             导出设置                    │
├─────────────────────────────────────────┤
│ 输出目录: [C:\Users\...\output] [浏览]   │
│                                         │
│ 文件命名:                               │
│ ○ 保留原文件名                          │
│ ○ 添加前缀: [wm_        ]               │
│ ○ 添加后缀: [_watermarked]              │
│                                         │
│ 输出格式: ○ JPEG  ○ PNG                 │
│                                         │
│ JPEG质量: [████████░░] 85               │
│                                         │
│ 图片缩放:                               │
│ ○ 不缩放                                │
│ ○ 按宽度: [1920] px                     │
│ ○ 按高度: [1080] px                     │
│ ○ 按比例: [100] %                       │
│                                         │
│           [取消]    [导出]              │
└─────────────────────────────────────────┘
```

### 4.3 交互流程
1. **启动应用** → 显示主窗口和欢迎界面
2. **导入图片** → 拖拽或点击按钮选择文件
3. **预览列表** → 显示缩略图和文件信息
4. **设置水印** → 在左侧面板配置水印参数
5. **导出设置** → 点击导出按钮，打开设置对话框
6. **开始导出** → 显示进度条，完成后提示结果

## 5. 质量要求

### 5.1 性能要求
- **启动时间**: 应用启动时间 < 3秒
- **缩略图生成**: 单张缩略图生成时间 < 500ms
- **界面响应**: 界面操作响应时间 < 200ms
- **内存使用**: 合理控制缩略图缓存，避免内存溢出

### 5.2 用户体验要求
- **直观操作**: 界面布局清晰，操作流程符合用户习惯
- **错误提示**: 提供友好的错误信息和解决建议
- **进度反馈**: 长时间操作显示进度条和状态信息
- **快捷键**: 支持常用操作的键盘快捷键

### 5.3 兼容性要求
- **操作系统**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **屏幕分辨率**: 支持1366x768及以上分辨率
- **高DPI支持**: 支持高分辨率显示器的DPI缩放

## 6. 测试计划

### 6.1 功能测试
- 文件导入功能测试（单个/批量/拖拽）
- 文件格式支持测试
- 导出功能和命名规则测试
- 图片缩放和质量调节测试

### 6.2 界面测试
- 不同分辨率下的界面显示测试
- 拖拽操作的兼容性测试
- 长文件名和特殊字符处理测试

### 6.3 性能测试
- 大量图片导入的性能测试
- 内存使用情况监控
- 界面响应速度测试

## 7. 实现计划

### 7.1 Phase 1: 基础框架 (1-2周)
- 选择GUI框架并搭建基础窗口
- 实现基本的文件导入功能
- 创建图片列表显示组件

### 7.2 Phase 2: 核心功能 (2-3周)
- 实现拖拽导入功能
- 完善文件格式支持
- 开发导出设置对话框

### 7.3 Phase 3: 优化完善 (1-2周)
- 界面美化和用户体验优化
- 性能优化和错误处理
- 测试和bug修复

## 8. 风险评估

### 8.1 技术风险
- **GUI框架学习成本**: 如选择PyQt，需要额外学习时间
- **跨平台兼容性**: 不同操作系统的界面表现可能有差异
- **性能问题**: 大量图片处理可能导致界面卡顿

### 8.2 缓解措施
- 先用tkinter快速原型，后续可升级到PyQt
- 在主要平台上进行充分测试
- 使用异步处理和进度反馈优化用户体验

---

**文档版本**: 1.0  
**创建日期**: 2025-09-28  
**最后更新**: 2025-09-28  
**状态**: 📋 待开发  
**优先级**: 高  
**预估工期**: 4-7周
