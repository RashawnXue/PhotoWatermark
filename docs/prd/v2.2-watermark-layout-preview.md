# PhotoWatermark PRD v2.2 - 水印布局与样式实时预览

## 版本信息
- **版本号**: v2.2
- **创建日期**: 2024-09-28
- **文档状态**: 草案
- **优先级**: 高

## 概述

本版本专注于提升用户体验，通过实时预览功能让用户能够直观地调整水印布局与样式。主要包括实时预览窗口、智能位置控制和交互式旋转功能。

## 功能需求

### 3.1 实时预览系统

#### 3.1.1 预览窗口核心功能
- **实时渲染**: 所有水印参数调整（位置、大小、颜色、透明度等）应立即在预览窗口中反映
- **多图片切换**: 用户可通过点击图片列表快速切换预览不同图片的水印效果
- **预览质量**: 预览图应保持足够清晰度以准确判断水印效果
- **响应性能**: 参数调整到预览更新的延迟应控制在100ms以内

#### 3.1.2 预览窗口布局
- **主预览区域**: 占据界面主要区域，显示当前选中图片的水印效果
- **缩放控制**: 提供放大/缩小功能，支持鼠标滚轮和缩放按钮
- **适应窗口**: 支持自适应窗口大小和手动调整预览区域尺寸

#### 3.1.3 图片列表交互
- **缩略图显示**: 在侧边栏或底部显示所有待处理图片的缩略图
- **选中状态**: 当前预览图片应有明显的选中状态标识
- **快速切换**: 点击任意缩略图立即切换预览，无需等待
- **批量状态**: 显示每张图片的处理状态（待处理/已预览/已导出）

### 3.2 位置控制系统

#### 3.2.1 预设位置功能
- **九宫格布局**: 提供9个预设位置选项
  - 左上角 (TOP_LEFT)
  - 正上方 (TOP_CENTER) 
  - 右上角 (TOP_RIGHT)
  - 左中间 (MIDDLE_LEFT)
  - 正中心 (CENTER)
  - 右中间 (MIDDLE_RIGHT)
  - 左下角 (BOTTOM_LEFT)
  - 正下方 (BOTTOM_CENTER)
  - 右下角 (BOTTOM_RIGHT)

- **一键定位**: 点击任意预设位置按钮，水印立即移动到对应位置
- **视觉反馈**: 当前选中的预设位置应有高亮显示
- **边距控制**: 每个预设位置应保持合适的边距，避免水印贴边

#### 3.2.2 手动拖拽功能
- **直接拖拽**: 用户可直接在预览图上用鼠标拖拽水印
- **拖拽反馈**: 拖拽过程中水印应跟随鼠标移动，提供实时视觉反馈
- **边界限制**: 水印拖拽范围限制在图片边界内
- **精确定位**: 支持像素级精确定位
- **拖拽指示**: 当鼠标悬停在水印上时，显示拖拽手势光标

#### 3.2.3 坐标显示与输入
- **坐标显示**: 实时显示当前水印的X、Y坐标位置
- **手动输入**: 允许用户直接输入具体坐标值进行精确定位
- **坐标单位**: 支持像素值和百分比两种单位
- **坐标验证**: 输入坐标时进行边界检查和有效性验证

### 3.3 旋转控制系统

#### 3.3.1 旋转控制界面
- **旋转滑块**: 提供-180°到+180°的旋转角度滑块
- **数值输入框**: 允许用户直接输入具体角度值
- **快捷角度**: 提供常用角度快捷按钮（0°、90°、180°、270°）
- **角度显示**: 实时显示当前旋转角度

#### 3.3.2 旋转交互体验
- **实时预览**: 拖动滑块或输入角度时，预览窗口立即显示旋转效果
- **平滑旋转**: 滑块拖动过程中旋转动画应平滑自然
- **角度精度**: 支持1度精度的角度调整
- **重置功能**: 提供一键重置到0度的功能

#### 3.3.3 旋转中心点
- **中心旋转**: 默认以水印中心为旋转点
- **旋转边界**: 旋转后的水印仍应保持在图片边界内
- **尺寸调整**: 旋转可能影响水印显示尺寸，需要智能调整

## 技术实现要求

### 3.4 性能要求
- **响应时间**: 参数调整到预览更新延迟 < 100ms
- **内存使用**: 预览功能不应显著增加内存占用
- **CPU占用**: 实时预览时CPU使用率应保持合理水平
- **多线程**: 预览渲染应在后台线程进行，不阻塞UI

### 3.5 兼容性要求
- **图片格式**: 支持所有已支持的图片格式进行预览
- **分辨率**: 支持各种分辨率图片的预览显示
- **水印类型**: 支持文本水印、图片水印、时间戳水印的预览
- **系统兼容**: 确保在不同操作系统上预览功能正常

### 3.6 用户体验要求
- **操作直观**: 所有控制操作应符合用户直觉
- **反馈及时**: 每个操作都应有及时的视觉反馈
- **错误处理**: 当操作无效时应给出友好的错误提示
- **状态保持**: 切换图片时应保持当前的水印设置

## 界面设计规范

### 3.7 布局结构
```
┌─────────────────────────────────────────────────────────────┐
│ 菜单栏                                                        │
├─────────────────────────────────────────────────────────────┤
│ 工具栏                                                        │
├──────────────────────┬──────────────────────────────────────┤
│ 图片列表               │ 主预览区域                              │
│ ┌──────────────────┐ │ ┌──────────────────────────────────┐ │
│ │ 缩略图1 [选中]     │ │ │                                  │ │
│ │ 缩略图2           │ │ │        预览图片                    │ │
│ │ 缩略图3           │ │ │      (带水印效果)                  │ │
│ │ ...              │ │ │                                  │ │
│ └──────────────────┘ │ └──────────────────────────────────┘ │
├──────────────────────┼──────────────────────────────────────┤
│ 位置控制面板           │ 旋转控制面板                           │
│ ┌──────────────────┐ │ ┌──────────────────────────────────┐ │
│ │ 九宫格位置选择     │ │ │ 角度滑块: [-180° ---- 0° ---- +180°] │ │
│ │ [TL][TC][TR]     │ │ │ 角度输入: [___°]                  │ │
│ │ [ML][MC][MR]     │ │ │ 快捷角度: [0°][90°][180°][270°]    │ │
│ │ [BL][BC][BR]     │ │ │ 重置按钮: [重置]                   │ │
│ │ 坐标: X[___] Y[___] │ │ └──────────────────────────────────┘ │
│ └──────────────────┘ │                                      │
└──────────────────────┴──────────────────────────────────────┘
```

### 3.8 交互设计
- **拖拽操作**: 水印在预览图上可拖拽，拖拽时显示半透明效果
- **悬停效果**: 鼠标悬停在水印上时显示边框和拖拽光标
- **选中状态**: 当前操作的水印应有明显的选中状态标识
- **操作提示**: 首次使用时提供操作引导提示

## 验收标准

### 3.9 功能验收
- [ ] 实时预览功能正常，所有参数调整立即生效
- [ ] 图片列表切换功能正常，预览同步更新
- [ ] 九宫格位置选择功能正常，一键定位准确
- [ ] 手动拖拽功能正常，拖拽流畅无卡顿
- [ ] 旋转控制功能正常，角度调整精确
- [ ] 坐标显示和输入功能正常

### 3.10 性能验收
- [ ] 预览更新延迟 < 100ms
- [ ] 拖拽操作流畅，帧率 > 30fps
- [ ] 内存使用增长 < 50MB
- [ ] CPU占用率 < 20%（空闲时）

### 3.11 兼容性验收
- [ ] 支持所有图片格式预览
- [ ] 支持各种分辨率图片
- [ ] 支持所有水印类型
- [ ] 在不同系统上功能正常

## 风险评估

### 3.12 技术风险
- **性能风险**: 实时预览可能影响应用性能
- **内存风险**: 大尺寸图片预览可能占用过多内存
- **兼容性风险**: 不同系统的拖拽实现可能存在差异

### 3.13 缓解措施
- **性能优化**: 使用图片缓存和后台渲染技术
- **内存管理**: 实现智能的图片缩放和内存回收
- **兼容性测试**: 在多个平台进行充分测试

## 开发计划

### 3.14 开发阶段
1. **阶段一**: 实时预览核心功能开发（1周）
2. **阶段二**: 位置控制系统开发（1周）
3. **阶段三**: 旋转控制系统开发（0.5周）
4. **阶段四**: 界面优化和测试（0.5周）

### 3.15 里程碑
- **M1**: 完成实时预览基础功能
- **M2**: 完成位置控制功能
- **M3**: 完成旋转控制功能
- **M4**: 完成整体功能测试和优化

---

*本文档将根据开发进展和用户反馈持续更新*
